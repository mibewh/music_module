define(["oneteam","ratchet/dynamic/empty","ui","ratchet/ratchet","jquery","ratchet/web","ratchet/dynamic/doclist","ratchet/actions","handlebars"],function(t,e,n,r,i,o,a,s,u){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var i=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(r),o=r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"});return[n].concat(o).concat([i]).join("\n")}return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<t.length;i++){var a=t[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e){t.exports=i},function(t,e,n){t.exports=n(7)},function(t,e,n){var r;void 0===(r=function(t){n(8),n(11),n(15),n(18),n(19),n(21).registerHelper("each_group",function(t,e,n){var r,i="",o=[];if(e&&e.length>0){for(r=0;r<e.length;r++)r>0&&r%t==0&&(i+=n.fn(o),o=[]),o.push(e[r]);i+=n.fn(o)}return i})}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){var r;void 0===(r=function(t,e,r){n(9);var i=n(10),o=n(2);return n(3).registerGadget("music-albums-list",o.extend({TEMPLATE:i,setup:function(){this.get("/projects/{projectId}/albums",this.index)},prepareModel:function(t,e,n){var r=this.observable("branch").get(),i=this.observable("project").get();this.base(t,e,function(){r.queryNodes({_type:"my:album"}).then(function(){e.albums=this.asArray();for(var t=0;t<e.albums.length;t++){var r=e.albums[t];r.imgUrl="/preview/repository/"+r.getRepositoryId()+"/branch/"+r.getBranchId()+"/node/"+r.getId()+"/default?size=128&name=preview128&force=true",r.artistUrl="/#/projects/"+i._doc+"/documents/"+r.artist.id,r.albumUrl="/#/projects/"+i._doc+"/documents/"+r._doc}n()})})}}))}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){(t.exports=n(0)(!1)).push([t.i,"",""])},function(t,e){t.exports='<div>\n    {{#each_group 3 albums}}\n        <div class="row">\n            {{#each this}}\n                <div class="col-sm-4">\n                    <div class="panel panel-default">\n                        <div class="panel-heading">\n                            <a href="{{albumUrl}}">\n                                <h3>{{title}}</h3>\n                            </a>\n                        </div>\n                        <div class="panel-body">\n                            <div class="media">\n                                <div class="media-left">\n                                    <img class="media-object" src="{{imgUrl}}" alt="{{title}}">\n                                </div>\n                                <div class="media-body">\n                                    <a href="{{artistUrl}}">\n                                        <h4>{{artist.title}}</h4>\n                                    </a>\n                                    {{{body}}}\n                                </div>\n                            </div>\n                        </div>\n                        <div class="panel-footer">\n                            Rating: {{rating}}\n                        </div>\n                    </div>\n                </div>\n            {{/each}}\n        </div>\n    {{/each_group}}\n</div>\n'},function(t,e,n){var r;void 0===(r=function(t,e,r){n(12);var i=n(13),o=n(14),a=n(1);return i.GadgetRegistry.register("music-albums-doclist",o.extend({configureDefault:function(){this.base(),this.config({observables:{query:"albums_query",sort:"albums_sort",sortDirection:"albums_sortDirection",searchTerm:"albums_searchTerm",selectedItems:"albums_selectedItems"}})},entityTypes:function(){return{plural:"albums",singular:"album"}},setup:function(){this.base(),this.get("/projects/{projectId}/albumslist",this.index)},doGitanaQuery:function(t,e,n,r,i,o){i.sort||(i.sort={title:1}),a.isEmptyOrNonExistent(r)&&n&&(r=a.searchQuery(n,["title"])),r._type="my:album",a.projectBranch(this,function(){this.queryNodes(r,i).then(function(){o(this)})})},linkUri:function(t){return this.observable("project").get(),a.linkUri(this,t)},iconUri:function(t){return a.iconUriForNode(t)},columnValue:function(t,e,n,r){var i=this.observable("project").get(),o=this.base(t,e);if("titleDescription"==e.key){var s=a.buildNodeSummary(t,!1,i),u=t.title;o=a.listTitleDescription(r,t,this.linkUri(t),u,!1,s)}return o}}))}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){(t.exports=n(0)(!1)).push([t.i,"",""])},function(t,e){t.exports=o},function(t,e){t.exports=a},function(t,e,n){var r;void 0===(r=function(t,e,r){n(16);var i=n(17),o=n(2);return n(3).registerGadget("music-artists-list",o.extend({TEMPLATE:i,setup:function(){this.get("/projects/{projectId}/artists",this.index)},prepareModel:function(t,e,n){var r=this.observable("branch").get(),i=this.observable("project").get();this.base(t,e,function(){r.queryNodes({_type:"my:artist"}).then(function(){var t=this.asArray();return t.forEach(function(t){t.url="/#/projects/"+i._doc+"/documents/"+t._doc}),t}).then(function(t){var e=this;return t.forEach(function(t){e.subchain(t).find({traverse:{associations:{"my:written_by":"INCOMING"},depth:1,types:["my:album"]}}).then(function(){t.albums=this.asArray(),t.albums.forEach(function(t){t.url="/#/projects/"+i._doc+"/documents/"+t._doc})})}),t}).then(function(t){e.artists=t,console.log(t),n()})})},doGitanaQuery:function(t,e,n,r,i,o){}}))}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){(t.exports=n(0)(!1)).push([t.i,"",""])},function(t,e){t.exports='<div>\n    {{#artists}}\n        <div class="row">\n            <div class="col-sm-12">\n                <div class="panel panel-default">\n                    <div class="panel-heading">\n                        <a href="{{url}}">\n                            <h3>{{title}}</h3>\n                        </a>\n                    </div>\n                    <div class="panel-body">\n                        {{{bio}}}\n                        {{#albums}}\n                        <p><a href="{{url}}">{{title}}</a></p>\n                        {{/albums}}\n                    </div>\n                </div>\n            </div>\n        </div>\n    {{/artists}}\n</div>\n'},function(t,e,n){var r;void 0===(r=function(t,e,r){n(4);var i=n(1),o=n(5);return Ratchet.Actions.register("create-album",Ratchet.AbstractUIAction.extend({execute:function(t,e,n){this.doAction(e,function(t,e){n(t,e)})},doAction:function(t,e){var n=this;Ratchet.fadeModal({title:"Create an Album",cancel:!0},function(r,a){o(r).find(".modal-body").html(""),o(r).find(".modal-body").append("<div class='form'></div>"),o(r).find(".modal-footer").append("<button class='btn btn-primary pull-right create'>Create</button>");var s={data:{},schema:{type:"object",properties:{artist:{type:"string",enum:[],required:!0},album:{type:"string",enum:[],required:!0},rating:{type:"number"},body:{type:"string"}}},options:{fields:{artist:{id:"artistField",type:"select",label:"Artist",dataSource:function(e){i.projectBranch(t,function(){this.queryNodes({_type:"my:artist"}).then(function(){var t=this.asArray().map(function(t){return{text:t.title,value:t.title+"\\"+t._doc}});e(t)})})},emptySelectFirst:!0},album:{id:"albumField",type:"select",label:"Album",dataSource:function(t){var e=this.observable("/artist").get();if(e){var n=e.split("\\")[0];o.get("http://ws.audioscrobbler.com/2.0/",{method:"artist.gettopalbums",artist:n,limit:10,api_key:"5985a9f09b144e0fa7e187799948c397",autocorrect:1,format:"json"}).done(function(e){var n=e.topalbums.album.map(function(t){var e=t.image[t.image.length-1]["#text"];return{value:t.name+"\\"+e,text:t.name}});t(n)}).fail(function(){t([])})}else t([])}},rating:{type:"integer",label:"Rating"},body:{type:"summernote",label:"Body"}},focus:"artist"},postRender:function(s){s.childrenByPropertyId.album.refresh(),s.childrenByPropertyId.artist.on("change",function(){s.childrenByPropertyId.album.refresh()}),i.bindFormChildEnterClick(s,o(r).find(".create")),o(r).find(".create").click(function(){i.processFormAction(s,r,function(r){n.addAlbum(t,r,function(){e()})})}),a(function(){})}},u=o(r).find(".form");i.formCreate(u,s)})},addAlbum:function(t,e,n){var r,o,a=this,s=e.artist.split("\\")[1];[r,o]=e.album.split("\\");var u=e.rating,c=e.body;a.block("Creating your album...",function(){i.projectBranch(t,function(t){Chain(t).readNode(s).then(function(){album={_type:"my:album",title:r,artUrl:o},u&&(album.rating=u),c&&(album.body=c),album.artist={ref:this.ref()},this.then(function(){this.subchain(t).createNode(album).then(function(){a.unblock(function(){n()})})})})})})}}))}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){var r;void 0===(r=function(t,e,r){var i=n(4),o=(n(20),n(1));return n(5),i.Actions.register("delete-albums",i.AbstractAction.extend({defaultConfiguration:function(){var t=this.base();return t.title="Remove Albums(s)",t.iconClass="glyphicon glyphicon-trash",t},execute:function(t,e,n){this.doAction(e,function(t,e){n(t,e)})},doAction:function(t,e){var n="";n+="<p>Please confirm that you would like to delete the following albums:</p>",n+="<br/>",n+="<ul>";for(var r=0;r<t.data.length;r++){var a=t.data[r].title;a||(a=t.data[r]._doc),n+="<li>"+o.filterXss(a)+"</li>"}n+="</ul>",i.fadeModalConfirm("Delete these Albums?",n,"Delete","btn-danger",function(n){var r=function(n){if(n>=t.data.length)return e();o.projectBranch(t,function(){var e=t.data[n].id;this.readNode(e).del().then(function(){r(n+1)})})};r(0)})}}))}.call(e,n,e,t))||(t.exports=r)},function(t,e){t.exports=s},function(t,e){t.exports=u}])});